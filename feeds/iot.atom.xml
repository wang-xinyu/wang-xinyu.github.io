<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>BlogWX</title><link href="https://wang-xinyu.github.io/" rel="alternate"></link><link href="https://wang-xinyu.github.io/feeds/iot.atom.xml" rel="self"></link><id>https://wang-xinyu.github.io/</id><updated>2015-11-27T00:00:00+08:00</updated><entry><title>Get Started with MQTT</title><link href="https://wang-xinyu.github.io/get-started-with-mqtt.html" rel="alternate"></link><updated>2015-11-27T00:00:00+08:00</updated><author><name>WangXinyu</name></author><id>tag:wang-xinyu.github.io,2015-11-27:get-started-with-mqtt.html</id><summary type="html">&lt;h1&gt;MQTT入门介绍&lt;/h1&gt;
&lt;p&gt;本文参考&lt;a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html"&gt;MQTT Version 3.1.1&lt;/a&gt;，根据个人的理解对MQTT进行入门级的介绍。&lt;/p&gt;
&lt;h2&gt;1. 概述&lt;/h2&gt;
&lt;p&gt;MQTT（MQ Telemetry Transport）是应用于M2M/IoT的传输协议，来自于IBM，已于2014年正式成为了OASIS标准。&lt;/p&gt;
&lt;p&gt;MQTT是极其简单、轻量级的协议，这是针对IoT的带宽低、延迟高、不稳定、终端设备功能简单等特点而设计的。MQTT在简单轻量的同时保证了通信的有效性和可靠性。&lt;/p&gt;
&lt;p&gt;MQTT采用客户端和服务器之间发布／订阅的方式进行消息传递。客户端可向服务器发布消息，也可向服务器订阅其它客户端发布的消息。服务器可被视为发布消息的客户端和订阅消息的客户端之间的中介。客户端之间不可直接传递消息，必须通过中介（服务器）来发布／订阅消息。&lt;/p&gt;
&lt;p&gt;MQTT可基于TCP/IP或其它有序的、丢包率低的、双向的网络协议。&lt;/p&gt;
&lt;p&gt;MQTT控制包（Control Packet）是网络中传输的MQTT信息的总称，控制包分为14种类型。&lt;/p&gt;
&lt;h2&gt;2. MQTT内容概况&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html"&gt;MQTT Version 3.1.1&lt;/a&gt;标准内容非常少，整个标准只有81页，包括的主要内容只有：&lt;/p&gt;
&lt;p&gt;（1）MQTT控制包（Control Packet）的通用格式；&lt;/p&gt;
&lt;p&gt;（2）14种控制包的具体说明；&lt;/p&gt;
&lt;p&gt;（3）通信的具体流程；&lt;/p&gt;
&lt;p&gt;（4）加密问题。&lt;/p&gt;
&lt;h2&gt;3. 控制包格式&lt;/h2&gt;
&lt;p&gt;MQTT控制包只有三部分，固定头、可选头、净荷，如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img alt="Alt Text" src="/images/MQTTctrlPktStruc.png" /&gt;&lt;/p&gt;
&lt;p&gt;固定头是每一种控制包都有的，大小为2Byte，包括控制包类型、标志和剩余长度三个字段，如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img alt="Alt Text" src="/images/MQTTfixHead.png" /&gt;&lt;/p&gt;
&lt;p&gt;可选头和净荷都存在于其中几种类型的控制包中，内容取决于包类型。&lt;/p&gt;
&lt;h2&gt;4. 控制包类型&lt;/h2&gt;
&lt;p&gt;下表是MQTT控制包的14种类型，C2S代表客户端到服务器，S2C反之。各类型控制包的具体内容请参阅&lt;a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html"&gt;MQTT Version 3.1.1&lt;/a&gt;。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="center"&gt;序号&lt;/th&gt;
&lt;th align="left"&gt;名称&lt;/th&gt;
&lt;th align="left"&gt;方向&lt;/th&gt;
&lt;th align="center"&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="center"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;CONNECT&lt;/td&gt;
&lt;td align="left"&gt;C2S&lt;/td&gt;
&lt;td align="center"&gt;客户端向服务器请求连接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;CONNACK&lt;/td&gt;
&lt;td align="left"&gt;S2C&lt;/td&gt;
&lt;td align="center"&gt;连接确认&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;PUBLISH&lt;/td&gt;
&lt;td align="left"&gt;C2S或S2C&lt;/td&gt;
&lt;td align="center"&gt;发布消息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;4&lt;/td&gt;
&lt;td align="left"&gt;PUBACK&lt;/td&gt;
&lt;td align="left"&gt;C2S或S2C&lt;/td&gt;
&lt;td align="center"&gt;发布确认&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;5&lt;/td&gt;
&lt;td align="left"&gt;PUBREC&lt;/td&gt;
&lt;td align="left"&gt;C2S或S2C&lt;/td&gt;
&lt;td align="center"&gt;已收到发布的消息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;6&lt;/td&gt;
&lt;td align="left"&gt;PUBREL&lt;/td&gt;
&lt;td align="left"&gt;C2S或S2C&lt;/td&gt;
&lt;td align="center"&gt;发布释放&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;7&lt;/td&gt;
&lt;td align="left"&gt;PUBCOMP&lt;/td&gt;
&lt;td align="left"&gt;C2S或S2C&lt;/td&gt;
&lt;td align="center"&gt;发布完成&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;8&lt;/td&gt;
&lt;td align="left"&gt;SUBSCRIBE&lt;/td&gt;
&lt;td align="left"&gt;C2S&lt;/td&gt;
&lt;td align="center"&gt;客户端的订阅请求&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;9&lt;/td&gt;
&lt;td align="left"&gt;SUBACK&lt;/td&gt;
&lt;td align="left"&gt;S2C&lt;/td&gt;
&lt;td align="center"&gt;订阅确认&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;10&lt;/td&gt;
&lt;td align="left"&gt;UNSUBSCRIBE&lt;/td&gt;
&lt;td align="left"&gt;C2S&lt;/td&gt;
&lt;td align="center"&gt;取消订阅&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;11&lt;/td&gt;
&lt;td align="left"&gt;UNSUBACK&lt;/td&gt;
&lt;td align="left"&gt;S2C&lt;/td&gt;
&lt;td align="center"&gt;取消订阅的确认&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;12&lt;/td&gt;
&lt;td align="left"&gt;PINGREQ&lt;/td&gt;
&lt;td align="left"&gt;C2S&lt;/td&gt;
&lt;td align="center"&gt;PING请求&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;13&lt;/td&gt;
&lt;td align="left"&gt;PINGRESP&lt;/td&gt;
&lt;td align="left"&gt;S2C&lt;/td&gt;
&lt;td align="center"&gt;PING响应&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;14&lt;/td&gt;
&lt;td align="left"&gt;DISCONNECT&lt;/td&gt;
&lt;td align="left"&gt;C2S&lt;/td&gt;
&lt;td align="center"&gt;客户端将断开连接&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;5. QoS等级和消息传递流程&lt;/h2&gt;
&lt;p&gt;MQTT应用消息的传递有3个保障级别，即3个QoS等级。不同QoS等级对应着不同的消息传递流程。&lt;/p&gt;
&lt;p&gt;（1）QoS 0: At most once delivery，至多一次传递。发送端仅发送一次，无重传，接收端无响应。消息可能到达接收端一次或零次。&lt;/p&gt;
&lt;p&gt;（2）QoS 1: At least once delivery，至少一次传递。接收端收到消息后返回PUBACK，消息至少到达接收端一次。&lt;/p&gt;
&lt;p&gt;（3）QoS 2: Exactly once delivery，消息传且仅传一次。此级别不允许丢包和消息重复。消息要经过两次确认，第一次发送端发送PUBLISH，接收端返回PUBREC；随后第二次发送端发送PUBREL，接收端返回PUBCOMP。&lt;/p&gt;
&lt;p&gt;注：本文为作者原创，转载请注明出处。&lt;/p&gt;</summary><category term="IoT"></category></entry></feed>